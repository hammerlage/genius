function zeraEstado(){idx=0,toques=[],arrayExpected=[],data=[]}function turnOnOff(){zeraEstado(),onOff=!onOff,$(".jogadas").html(onOff?"000":""),onOff&&($("#myModal").modal("show"),$(".btn").sort(function(a,t){return $(a).data("cor")-$(t).data("cor")}).each(function(a,t){pisca($(t),DELAY*(a+1))}))}function start(){zeraEstado(),(currRecord={}).userName=username,currRecord.gameId=guid(),proximaJogada()}function lose(){var a=data.slice();data=[],submitGameData(a),$(".jogadas").data("score",lpad(toques.length,3,"0")),zeraEstado(),$(".jogadas").html("FAIL"),playLose(),animaLose()}function animaLose(){!onOff||toques.length>0||(j=$(".jogadas"),j.html("FAIL"==j.html()?j.data("score"):"FAIL"),setTimeout(animaLose,2*DELAY))}function proximaJogada(){if(onOff){for(blockGame=!0,idx=0,toques.push(Math.floor(4*Math.random())),i=0;i<toques.length;i++){var a=toques[i];pisca($(".btn[data-cor="+a+"]"),DELAY*(i+1),i==toques.length-1)}arrayExpected.push($(".btn[data-cor="+toques[toques.length-1]+"]").data("ncor")),currRecord.roundChallenge=arrayExpected,$(".jogadas").html(lpad(toques.length,3,"0"))}}function pisca(a,t,e){setTimeout(function(){playCor($(a).data("cor")),$(a).find("img").fadeIn(24,function(){$(this).fadeOut()}),e&&(blockGame=!1,currRecord.roundStartAt=new Date,currRecord.roundStartTimestamp=performance.now())},t)}function lpad(a,t,e){for(a=a.toString(),i=a.length+1;i<=t;i++)a=e+a;return a}function guid(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function getRanking(){var a={async:!0,crossDomain:!0,url:"https://genius-io-project.appspot.com/api/ranking",method:"GET",cache:"true",processData:!1};$.ajax(a).done(function(a){$("#lista-ranking").empty();for(var t=0;t<a.length;t++)if(t<=4){var e=a[t];$("#lista-ranking").append("<li><mark>"+e.name+"</mark><small>"+e.score+"</small></li>")}})}function submitGameData(a){var t={async:!0,crossDomain:!0,url:"https://genius-io-project.appspot.com/api/clicks",method:"POST",headers:{"content-type":"application/json; charset=utf-8"},processData:!1,data:JSON.stringify(a)};$.ajax(t).done(function(a){console.log(a)})}DELAY=400;var onOff=!1,idx=0,toques=[],arrayExpected=[],arrayPlayed=[],username="",currRecord={},data=[],blockGame=!0,DATETIME_FORMAT="YYYY-MM-DD HH:mm:ss:mmmm";$(document).ready(function(){setupAudio(),getRanking(),$("#btn-save-user").on("click",function(a){username=$("#txt-username").val(),$("#myModal").modal("hide")}),$("#txt-username").keypress(function(a){(a.which<48||a.which>57&&a.which<65||a.which>90&&a.which<97||a.which>122)&&a.preventDefault()}),$(".btn-on-off").click(function(){turnOnOff()}),$(".btn-start").click(function(){start()}),$(".btn-mute").click(function(){audioOnOff=!audioOnOff,$(this).find("img").attr("src",audioOnOff?"img/btn_sound_on.png":"img/btn_sound_off.png")}),$(".btn").click(function(a){var t=new Date,e=a.timeStamp;if(!(!onOff||toques.length<=0||blockGame)){currRecord.clickTimeAt=t;var o={userName:currRecord.userName,gameId:currRecord.gameId,roundChallenge:currRecord.roundChallenge.slice(),roundStartAt:moment(currRecord.roundStartAt).format(DATETIME_FORMAT),roundStartTimestamp:currRecord.roundStartTimestamp,clickTimeAt:moment(currRecord.clickTimeAt).format(DATETIME_FORMAT),clickTimestamp:e,roundSuccess:!0};data.push(o);var r=$(this).data("cor");if(o.currClickAnswer=arrayExpected.slice(0,idx),o.currClickAnswer.push($(".btn[data-cor="+r+"]").data("ncor")),toques[idx]==r)d=new Date,pisca($(this),0),++idx==toques.length&&setTimeout(proximaJogada,DELAY);else{for(var n=0;n<data.length;++n){var c=data[n];c.gameId==currRecord.gameId&&c.roundChallenge.length==currRecord.roundChallenge.length&&(c.roundSuccess=!1)}setTimeout(lose,DELAY)}}})});